webpackJsonp([1],{"+VGo":function(e,t){},0:function(e,t,n){e.exports=n("x35b")},Gs6A:function(e,t){},NuQr:function(e,t){},x35b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("/5sW"),r=(n("U6qc"),n("Gh7F"),n("uDYd"),n("gbyG"),n("SldL"),n("y9m4"),n("JQN8")),i=n("Q1TF"),c=n("yBIK"),o=n.n(c),s=n("ocMT"),u=n.n(s),l=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function c(e){try{s(a.next(e))}catch(e){i(e)}}function o(e){try{s(a["throw"](e))}catch(e){i(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(c,o)}s((a=a.apply(e,t||[])).next())})},h=n("y1vT"),d=a["a"].extend({name:"MapContainer",props:["vehicleData","checkedValues"],data:function(){return{geojsonData:{},zoom:void 0,zoomScale:void 0}},created:function(){return l(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,a,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.geojsonData.features=[],this.geojsonData.type="FeatureCollection",e.next=4,fetch("../streets.ndjson");case 4:return t=e.sent,e.next=7,u()(t.body);case 7:n=e.sent,a=n.getReader();case 9:return e.next=12,a.read();case 12:if(r=e.sent,!r.done){e.next=15;break}return e.abrupt("break",18);case 15:this.geojsonData.features.push(r.value),e.next=9;break;case 18:case"end":return e.stop()}},e,this)}))},mounted:function(){var e=this;this.zoom=o()(document.getElementById("panZoomRoot"),{maxZoom:10,minZoom:1,beforeWheel:h(function(){e.setZoomScale()},60)}),this.setZoomScale();var t=document.getElementById("map");t.addEventListener("dblclick",this.setZoomScale),t.addEventListener("touchstart",h(function(){e.setZoomScale()},60)),t.addEventListener("keydown",h(function(){e.setZoomScale()},60))},methods:{setZoomScale:function(){this.zoomScale=this.zoom.getTransform().scale}},computed:{pathFunction:function(){return Object(r["b"])(this.projection)},projection:function(){return Object(r["a"])().scale(306337.6140209504).center([-122.43595722806097,37.77071992617303]).translate([this.$el.clientWidth/2,this.$el.clientHeight/2])},emojiSize:function(){return Object(i["a"])().domain([1,10]).range([12,2])},vehicleStyle:function(){return void 0===this.zoom?"15px":{"font-size":"".concat(this.emojiSize(this.zoomScale),"px")}}}}),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{attrs:{id:"map"}},[n("g",{attrs:{id:"panZoomRoot"}},[n("g",{attrs:{id:"mapPaths"}},[e._l(e.geojsonData.features,function(t){return[n("path",{class:t.type,attrs:{d:e.pathFunction(t)}})]})],2),n("g",{style:e.vehicleStyle},[e._l(e.vehicleData,function(t){return[0===e.checkedValues.length||e.checkedValues.includes(t.properties.routeTag)?[n("text",{class:Number.parseInt(t.properties.routeTag)?"bus":"trolley",attrs:{x:e.projection(t.coordinates)[0],y:e.projection(t.coordinates)[1],route:t.properties.routeTag}},[e._v(e._s(Number.parseInt(t.properties.routeTag)?"ðŸšŒ":"ðŸš‹"))])]:e._e()]})],2)])])},v=[],f=n("XyMi");function m(e){n("Gs6A")}var g=!1,k=m,b="data-v-07819959",x=null,y=Object(f["a"])(d,p,v,g,k,b,x),w=y.exports,D=(n("beEN"),a["a"].extend({name:"FilterContainer",props:["allRoutes"],data:function(){return{checkedValues:[]}},methods:{idString:function(e){return"route-".concat(e)},resetChecked:function(){this.checkedValues=[],Array.from(document.querySelectorAll("input[type=checkbox]")).forEach(function(e){e.checked=!1})}},watch:{checkedValues:function(e,t){this.$emit("change",e)}}})),_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"filterContainer"}},[n("div",{attrs:{id:"filterWrapper"}},[n("button",{on:{click:e.resetChecked}},[e._v("Reset")]),n("span",[e._v("Filter routes")]),e._l(e.allRoutes,function(t,a){return[n("div",{staticClass:"checkboxContainer"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.checkedValues,expression:"checkedValues"}],attrs:{type:"checkbox",id:e.idString(a)},domProps:{value:t,checked:Array.isArray(e.checkedValues)?e._i(e.checkedValues,t)>-1:e.checkedValues},on:{change:function(n){var a=e.checkedValues,r=n.target,i=!!r.checked;if(Array.isArray(a)){var c=t,o=e._i(a,c);r.checked?o<0&&(e.checkedValues=a.concat([c])):o>-1&&(e.checkedValues=a.slice(0,o).concat(a.slice(o+1)))}else e.checkedValues=i}}}),n("label",{attrs:{for:e.idString(a)}},[e._v(e._s(t))])])]})],2)])},S=[];function j(e){n("NuQr")}var V=!1,R=j,T="data-v-2e89bee2",C=null,z=Object(f["a"])(D,_,S,V,R,T,C),E=z.exports,F=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function c(e){try{s(a.next(e))}catch(e){i(e)}}function o(e){try{s(a["throw"](e))}catch(e){i(e)}}function s(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(c,o)}s((a=a.apply(e,t||[])).next())})},O=a["a"].extend({name:"app",components:{MapContainer:w,FilterContainer:E},data:function(){return{checkedValues:[],vehicleData:[]}},created:function(){return F(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.getvehicleData(!0),window.setInterval(this.getvehicleData,3e3);case 2:case"end":return e.stop()}},e,this)}))},computed:{allRoutes:function(){for(var e=[],t=0;t<this.vehicleData.length;t++)e.includes(this.vehicleData[t].properties.routeTag)||e.push(this.vehicleData[t].properties.routeTag);return e.sort()}},methods:{getvehicleData:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return F(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,a,r,i,c,o=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://cors-anywhere.herokuapp.com/http://webservices.nextbus.com/service/publicJSONFeed?command=vehicleLocations&a=sf-muni&t=".concat(e?0:Date.now()-15e3));case 2:return n=t.sent,t.next=5,n.json();case 5:for(a=t.sent,r=this.vehicleData.map(function(e){return e.properties.id}),i=function(e){if(r.includes(a.vehicle[e].id)){var t=o.vehicleData.findIndex(function(t){return t.properties.id===a.vehicle[e].id});o.updatevehicle(a.vehicle[e],t)}else o.vehicleData.push(o.getvehicleObject(a.vehicle[e]))},c=0;c<a.vehicle.length;c++)i(c);case 9:case"end":return t.stop()}},t,this)}))},getvehicleObject:function(e){return{coordinates:[e.lon,e.lat],properties:{id:e.id,routeTag:e.routeTag,secsSinceReport:e.secsSinceReport,speedKmHr:e.speedKmHr,heading:e.heading}}},updatevehicle:function(e,t){a["a"].set(this.vehicleData[t],"coordinates",[e.lon,e.lat]),a["a"].set(this.vehicleData[t].properties,"secsSinceReport",e.secsSinceReport),a["a"].set(this.vehicleData[t].properties,"speedKmHr",e.speedKmHr),a["a"].set(this.vehicleData[t].properties,"heading",e.heading)}}}),Z=function(){var e=this,t=this,n=t.$createElement,a=t._self._c||n;return a("div",{attrs:{id:"app"}},[a("MapContainer",{attrs:{vehicleData:t.vehicleData,checkedValues:t.checkedValues}}),a("FilterContainer",{attrs:{allRoutes:t.allRoutes},on:{change:function(t){return e.checkedValues=t}}})],1)},A=[];function N(e){n("+VGo")}var I=!1,$=N,G=null,M=null,H=Object(f["a"])(O,Z,A,I,$,G,M),K=H.exports;a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(K)}}).$mount("#app")}},[0]);
//# sourceMappingURL=app.24f66e20.js.map