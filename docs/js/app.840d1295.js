webpackJsonp([1],{"+VGo":function(e,t){},0:function(e,t,n){e.exports=n("x35b")},"79lO":function(e,t){},NuQr:function(e,t){},x35b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("/5sW"),a=(n("U6qc"),n("Gh7F"),n("uDYd"),n("gbyG"),n("SldL"),n("y9m4"),n("JQN8")),i=n("Q1TF"),c=n("yBIK"),o=n.n(c),s=n("ocMT"),u=n.n(s),l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r["throw"](e))}catch(e){i(e)}}function s(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(c,o)}s((r=r.apply(e,t||[])).next())})},h=n("y1vT"),d=r["a"].extend({name:"MapContainer",props:["vehicleData","checkedValues"],data:function(){return{geojsonData:{},zoom:void 0,zoomScale:void 0}},created:function(){return l(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r,a,i,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.geojsonData.features=[],this.geojsonData.type="FeatureCollection",e.next=4,fetch("./all.ndjson");case 4:return t=e.sent,e.next=7,u()(t.body);case 7:n=e.sent,r=n.getReader(),a=document.getElementById("mapPaths");case 10:return e.next=13,r.read();case 13:if(i=e.sent,!i.done){e.next=16;break}return e.abrupt("break",22);case 16:c=document.createElementNS("http://www.w3.org/2000/svg","path"),c.setAttributeNS(null,"d",String(this.pathFunction(i.value))),c.setAttributeNS(null,"type",i.value.geometry.type),a.appendChild(c),e.next=10;break;case 22:case"end":return e.stop()}},e,this)}))},mounted:function(){var e=this;this.zoom=o()(document.getElementById("panZoomRoot"),{maxZoom:10,minZoom:1,beforeWheel:h(function(){e.setZoomScale()},60)}),this.setZoomScale();var t=document.getElementById("map");t.addEventListener("dblclick",this.setZoomScale),t.addEventListener("touchstart",h(function(){e.setZoomScale()},60)),t.addEventListener("keydown",h(function(){e.setZoomScale()},60))},methods:{setZoomScale:function(){this.zoomScale=this.zoom.getTransform().scale}},computed:{pathFunction:function(){return Object(a["b"])(this.projection)},projection:function(){return Object(a["a"])().scale(306337.6140209504).center([-122.43595722806097,37.77071992617303]).translate([this.$el.clientWidth/2,this.$el.clientHeight/2])},emojiSize:function(){return Object(i["a"])().domain([1,10]).range([12,2])},vehicleStyle:function(){return void 0===this.zoom?"15px":{"font-size":"".concat(this.emojiSize(this.zoomScale),"px")}}}}),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{attrs:{id:"map"}},[n("g",{attrs:{id:"panZoomRoot"}},[n("g",{attrs:{id:"mapPaths"}}),n("g",{style:e.vehicleStyle},[e._l(e.vehicleData,function(t){return[0===e.checkedValues.length||e.checkedValues.includes(t.properties.routeTag)?[n("text",{class:Number.parseInt(t.properties.routeTag)?"bus":"trolley",attrs:{x:e.projection(t.coordinates)[0],y:e.projection(t.coordinates)[1],route:t.properties.routeTag}},[e._v(e._s(Number.parseInt(t.properties.routeTag)?"ðŸšŒ":"ðŸš‹"))])]:e._e()]})],2)])])},v=[],f=n("XyMi");function m(e){n("79lO")}var g=!1,k=m,b=null,y=null,x=Object(f["a"])(d,p,v,g,k,b,y),w=x.exports,S=(n("beEN"),r["a"].extend({name:"FilterContainer",props:["allRoutes"],data:function(){return{checkedValues:[]}},methods:{idString:function(e){return"route-".concat(e)},resetChecked:function(){this.checkedValues=[],Array.from(document.querySelectorAll("input[type=checkbox]")).forEach(function(e){e.checked=!1})}},watch:{checkedValues:function(e,t){this.$emit("change",e)}}})),D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"filterContainer"}},[n("div",{attrs:{id:"filterWrapper"}},[n("button",{on:{click:e.resetChecked}},[e._v("Reset")]),n("span",[e._v("Filter routes")]),e._l(e.allRoutes,function(t,r){return[n("div",{staticClass:"checkboxContainer"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.checkedValues,expression:"checkedValues"}],attrs:{type:"checkbox",id:e.idString(r)},domProps:{value:t,checked:Array.isArray(e.checkedValues)?e._i(e.checkedValues,t)>-1:e.checkedValues},on:{change:function(n){var r=e.checkedValues,a=n.target,i=!!a.checked;if(Array.isArray(r)){var c=t,o=e._i(r,c);a.checked?o<0&&(e.checkedValues=r.concat([c])):o>-1&&(e.checkedValues=r.slice(0,o).concat(r.slice(o+1)))}else e.checkedValues=i}}}),n("label",{attrs:{for:e.idString(r)}},[e._v(e._s(t))])])]})],2)])},_=[];function V(e){n("NuQr")}var j=!1,R=V,C="data-v-2e89bee2",T=null,E=Object(f["a"])(S,D,_,j,R,C,T),O=E.exports,N=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function o(e){try{s(r["throw"](e))}catch(e){i(e)}}function s(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(c,o)}s((r=r.apply(e,t||[])).next())})},z=r["a"].extend({name:"app",components:{MapContainer:w,FilterContainer:O},data:function(){return{checkedValues:[],vehicleData:[]}},created:function(){return N(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.getvehicleData(!0),window.setInterval(this.getvehicleData,3e3);case 2:case"end":return e.stop()}},e,this)}))},computed:{allRoutes:function(){for(var e=[],t=0;t<this.vehicleData.length;t++)e.includes(this.vehicleData[t].properties.routeTag)||e.push(this.vehicleData[t].properties.routeTag);return e.sort()}},methods:{getvehicleData:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return N(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,a,i,c,o=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://cors-anywhere.herokuapp.com/http://webservices.nextbus.com/service/publicJSONFeed?command=vehicleLocations&a=sf-muni&t=".concat(e?0:Date.now()-15e3));case 2:return n=t.sent,t.next=5,n.json();case 5:for(r=t.sent,a=this.vehicleData.map(function(e){return e.properties.id}),i=function(e){if(a.includes(r.vehicle[e].id)){var t=o.vehicleData.findIndex(function(t){return t.properties.id===r.vehicle[e].id});o.updatevehicle(r.vehicle[e],t)}else o.vehicleData.push(o.getvehicleObject(r.vehicle[e]))},c=0;c<r.vehicle.length;c++)i(c);case 9:case"end":return t.stop()}},t,this)}))},getvehicleObject:function(e){return{coordinates:[e.lon,e.lat],properties:{id:e.id,routeTag:e.routeTag,secsSinceReport:e.secsSinceReport,speedKmHr:e.speedKmHr,heading:e.heading}}},updatevehicle:function(e,t){r["a"].set(this.vehicleData[t],"coordinates",[e.lon,e.lat]),r["a"].set(this.vehicleData[t].properties,"secsSinceReport",e.secsSinceReport),r["a"].set(this.vehicleData[t].properties,"speedKmHr",e.speedKmHr),r["a"].set(this.vehicleData[t].properties,"heading",e.heading)}}}),F=function(){var e=this,t=this,n=t.$createElement,r=t._self._c||n;return r("div",{attrs:{id:"app"}},[r("MapContainer",{attrs:{vehicleData:t.vehicleData,checkedValues:t.checkedValues}}),r("FilterContainer",{attrs:{allRoutes:t.allRoutes},on:{change:function(t){return e.checkedValues=t}}})],1)},Z=[];function A(e){n("+VGo")}var I=!1,$=A,M=null,P=null,H=Object(f["a"])(z,F,Z,I,$,M,P),K=H.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(K)}}).$mount("#app")}},[0]);
//# sourceMappingURL=app.840d1295.js.map