webpackJsonp([1],{"+VGo":function(e,t){},0:function(e,t,n){e.exports=n("x35b")},"79lO":function(e,t){},NuQr:function(e,t){},SrRq:function(e,t){},x35b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("/5sW"),o=(n("U6qc"),n("Gh7F"),n("uDYd"),n("gbyG"),n("SldL"),n("y9m4"),n("YVn/"),n("+Uzz")),c=i["a"].extend({name:"MapContainer",props:["checkedValues","vehicle","projection"],data:function(){return{xPosition:0,yPosition:0}},created:function(){this.xPosition=this.xComputed,this.yPosition=this.yComputed},watch:{xComputed:function(e,t){var n=function(){var e=Object.values(i);e.pop(),this.xPosition=e[0]},i={},c={onUpdate:n,ease:Power1.easeOut,onUpdateScope:this};i[0]=t,c[0]=e,o["TweenMax"].to(i,2,c)},yComputed:function(e,t){var n=function(){var e=Object.values(i);e.pop(),this.yPosition=e[0]},i={},c={onUpdate:n,ease:Power1.easeOut,onUpdateScope:this};i[0]=t,c[0]=e,o["TweenMax"].to(i,2,c)}},computed:{styleObject:function(){return{display:0===this.checkedValues.length||this.checkedValues.includes(this.vehicle.properties.routeTag)?"block":"none"}},xComputed:function(){return this.projection(this.vehicle.coordinates)[0]},yComputed:function(){return this.projection(this.vehicle.coordinates)[1]}}}),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("text",{class:Number.parseInt(e.vehicle.properties.routeTag)?"bus":"trolley",style:e.styleObject,attrs:{x:e.xPosition,y:e.yPosition,route:e.vehicle.properties.routeTag}},[e._v(e._s(Number.parseInt(e.vehicle.properties.routeTag)?"ðŸšŒ":"ðŸš‹"))])},r=[],s=n("XyMi");function u(e){n("SrRq")}var l=!1,h=u,d=null,p=null,v=Object(s["a"])(c,a,r,l,h,d,p),f=v.exports,m=n("JQN8"),g=n("Q1TF"),y=n("yBIK"),x=n.n(y),k=n("ocMT"),b=n.n(k),w=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,c){function a(e){try{s(i.next(e))}catch(e){c(e)}}function r(e){try{s(i["throw"](e))}catch(e){c(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,r)}s((i=i.apply(e,t||[])).next())})},S=n("y1vT"),j=i["a"].extend({name:"MapContainer",props:["vehicleData","checkedValues"],components:{Vehicle:f},data:function(){return{geojsonData:{},zoom:void 0,zoomScale:void 0}},created:function(){return w(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i,o,c,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.geojsonData.features=[],this.geojsonData.type="FeatureCollection",e.next=4,fetch("./all.ndjson");case 4:return t=e.sent,e.next=7,b()(t.body);case 7:return n=e.sent,i=n.getReader(),o=document.getElementById("mapPaths"),e.next=12,i.read();case 12:c=e.sent;case 13:if(c.done){e.next=23;break}return a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttributeNS(null,"d",String(this.pathFunction(c.value))),a.setAttributeNS(null,"type",c.value.geometry.type),o&&o.appendChild(a),e.next=20,i.read();case 20:c=e.sent,e.next=13;break;case 23:case"end":return e.stop()}},e,this)}))},mounted:function(){var e=this,t=document.getElementById("panZoomRoot");t&&(this.zoom=x()(t,{maxZoom:10,minZoom:1,beforeWheel:S(function(){e.setZoomScale()},60)}),this.setZoomScale());var n=document.getElementById("map");n&&(n.addEventListener("dblclick",this.setZoomScale),n.addEventListener("touchstart",S(function(){e.setZoomScale()},60)),n.addEventListener("keydown",S(function(){e.setZoomScale()},60)))},methods:{setZoomScale:function(){this.zoomScale=this.zoom.getTransform().scale}},computed:{pathFunction:function(){return Object(m["b"])(this.projection)},projection:function(){return Object(m["a"])().scale(306337.6140209504).center([-122.43595722806097,37.77071992617303]).translate([this.$el.clientWidth/2,this.$el.clientHeight/2])},emojiSize:function(){return Object(g["a"])().domain([1,10]).range([12,2])},vehicleStyle:function(){return void 0===this.zoom?{"font-size":"15px"}:{"font-size":"".concat(this.emojiSize(this.zoomScale),"px")}}}}),V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("svg",{attrs:{id:"map"}},[n("g",{attrs:{id:"panZoomRoot"}},[n("g",{attrs:{id:"mapPaths"}}),n("g",{style:e.vehicleStyle,attrs:{id:"vehicleRoot"}},[e._l(e.vehicleData,function(t){return[n("Vehicle",{key:t.properties.id,attrs:{checkedValues:e.checkedValues,vehicle:t,projection:e.projection}})]})],2)])])},_=[];function D(e){n("79lO")}var R=!1,C=D,O=null,P=null,T=Object(s["a"])(j,V,_,R,C,O,P),z=T.exports,E=(n("beEN"),i["a"].extend({name:"FilterContainer",props:["allRoutes"],data:function(){return{checkedValues:[]}},methods:{idString:function(e){return"route-".concat(e)},resetChecked:function(){this.checkedValues=[],Array.from(document.querySelectorAll("input[type=checkbox]")).forEach(function(e){e.checked=!1})}},watch:{checkedValues:function(e,t){this.$emit("change",e)}}})),N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"filterContainer"}},[n("div",{attrs:{id:"filterWrapper"}},[n("button",{on:{click:e.resetChecked}},[e._v("Reset")]),n("span",[e._v("Filter routes")]),e._l(e.allRoutes,function(t,i){return[n("div",{staticClass:"checkboxContainer"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.checkedValues,expression:"checkedValues"}],attrs:{type:"checkbox",id:e.idString(i)},domProps:{value:t,checked:Array.isArray(e.checkedValues)?e._i(e.checkedValues,t)>-1:e.checkedValues},on:{change:function(n){var i=e.checkedValues,o=n.target,c=!!o.checked;if(Array.isArray(i)){var a=t,r=e._i(i,a);o.checked?r<0&&(e.checkedValues=i.concat([a])):r>-1&&(e.checkedValues=i.slice(0,r).concat(i.slice(r+1)))}else e.checkedValues=c}}}),n("label",{attrs:{for:e.idString(i)}},[e._v(e._s(t))])])]})],2)])},F=[];function Z(e){n("NuQr")}var M=!1,A=Z,I="data-v-2e89bee2",$=null,U=Object(s["a"])(E,N,F,M,A,I,$),H=U.exports,K=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,c){function a(e){try{s(i.next(e))}catch(e){c(e)}}function r(e){try{s(i["throw"](e))}catch(e){c(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,r)}s((i=i.apply(e,t||[])).next())})},L=i["a"].extend({name:"app",components:{MapContainer:z,FilterContainer:H},data:function(){return{checkedValues:[],vehicleData:[]}},created:function(){return K(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.getvehicleData(!0),window.setInterval(this.getvehicleData,3e3);case 2:case"end":return e.stop()}},e,this)}))},computed:{allRoutes:function(){for(var e=[],t=0;t<this.vehicleData.length;t++)e.includes(this.vehicleData[t].properties.routeTag)||e.push(this.vehicleData[t].properties.routeTag);return e.sort()}},methods:{getvehicleData:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return K(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,o,c,a,r=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://cors-anywhere.herokuapp.com/http://webservices.nextbus.com/service/publicJSONFeed?command=vehicleLocations&a=sf-muni&t=".concat(e?0:Date.now()-15e3));case 2:return n=t.sent,t.next=5,n.json();case 5:for(i=t.sent,o=this.vehicleData.map(function(e){return e.properties.id}),c=function(e){if(o.includes(i.vehicle[e].id)){var t=r.vehicleData.findIndex(function(t){return t.properties.id===i.vehicle[e].id});r.updatevehicle(i.vehicle[e],t)}else r.vehicleData.push(r.getvehicleObject(i.vehicle[e]))},a=0;a<i.vehicle.length;a++)c(a);case 9:case"end":return t.stop()}},t,this)}))},getvehicleObject:function(e){return{coordinates:[e.lon,e.lat],properties:{id:e.id,routeTag:e.routeTag,secsSinceReport:e.secsSinceReport,speedKmHr:e.speedKmHr,heading:e.heading}}},updatevehicle:function(e,t){i["a"].set(this.vehicleData[t],"coordinates",[e.lon,e.lat]),i["a"].set(this.vehicleData[t].properties,"secsSinceReport",e.secsSinceReport),i["a"].set(this.vehicleData[t].properties,"speedKmHr",e.speedKmHr),i["a"].set(this.vehicleData[t].properties,"heading",e.heading)}}}),q=function(){var e=this,t=this,n=t.$createElement,i=t._self._c||n;return i("div",{attrs:{id:"app"}},[i("MapContainer",{attrs:{vehicleData:t.vehicleData,checkedValues:t.checkedValues}}),i("FilterContainer",{attrs:{allRoutes:t.allRoutes},on:{change:function(t){return e.checkedValues=t}}})],1)},B=[];function G(e){n("+VGo")}var Q=!1,W=G,J=null,Y=null,X=Object(s["a"])(L,q,B,Q,W,J,Y),ee=X.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(e){return e(ee)}}).$mount("#app")}},[0]);
//# sourceMappingURL=app.65bbda00.js.map